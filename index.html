<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Live Parade Script</title>
<style>
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: "Arial", sans-serif;
    font-size: 2.2rem;
    line-height: 1.4;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  #container {
    flex: 1;
    overflow-y: auto;
    scroll-behavior: smooth;
    padding: 2rem 3rem;
  }
  .entry {
    margin-bottom: 3rem;
    padding: 1rem;
    border-left: 6px solid transparent;
    transition: border-color 0.5s ease;
  }
  .entry.current {
    border-color: #ffcc00;
    background: rgba(255, 204, 0, 0.1);
  }
  .entry.next {
    border-color: #666;
    background: rgba(255, 255, 255, 0.05);
  }
  h2 {
    color: #ffcc00;
    margin: 0 0 0.5rem 0;
    font-size: 2.4rem;
  }
  p {
    margin: 0;
  }
  #controls {
    background: #111;
    display: flex;
    justify-content: center;
    gap: 2rem;
    padding: 1rem 0;
    border-top: 2px solid #333;
  }
  button {
    font-size: 1.4rem;
    background: #333;
    color: #ffcc00;
    border: none;
    padding: 0.8rem 1.6rem;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background: #555;
  }
</style>
</head>
<body>

<div id="container"></div>

<div id="controls">
  <button id="prevBtn">⬅ Previous</button>
  <button id="nextBtn">Next ➡</button>
</div>

<script>
const FEED_URL = "https://script.google.com/macros/s/AKfycbwtsXm15TcynE5Fizg36hTchJS94FjC1Qkbr22ZnYK7l8R1RWk1-f8Fe04W2rSledwf/exec";

let entries = [];
let currentIndex = 0;

// Fetch the JSON feed
async function loadScript() {
  try {
    const res = await fetch(FEED_URL + "?t=" + Date.now());
    if (!res.ok) throw new Error("Feed not reachable (" + res.status + ")");
    const text = await res.text();
    if (!text.trim()) throw new Error("Empty feed response");
    entries = JSON.parse(text);

    if (!Array.isArray(entries) || entries.length === 0) {
      showNoDataMessage("No data yet. Waiting for parade lineup...");
      return;
    }

    renderEntries();
  } catch (e) {
    console.error("Fetch or parse error:", e);
    showNoDataMessage("Error loading data — check feed or network.");
  }
}

// Render the current + next entry
function renderEntries() {
  const container = document.getElementById("container");
  const current = entries[currentIndex];
  const next = entries[currentIndex + 1];

  let html = "";
  if (current) {
    html += `
      <div class="entry current">
        <h2>${current.number}. ${current.organization}</h2>
        <p>${current.description}</p>
      </div>`;
  }
  if (next) {
    html += `
      <div class="entry next">
        <h2>Next: ${next.number}. ${next.organization}</h2>
        <p>${next.description}</p>
      </div>`;
  }

  container.innerHTML = html;
  container.scrollTop = 0;
}

// Show placeholder or error message
function showNoDataMessage(msg) {
  document.getElementById("container").innerHTML = `
    <div style="text-align:center; margin-top:40vh;">
      <h2 style="color:#ffcc00;">${msg}</h2>
      <p style="font-size:1.5rem; color:#ccc;">
        The live announcer feed will appear here as soon as the first group checks in.
      </p>
    </div>`;
}

// Manual controls
document.getElementById("nextBtn").addEventListener("click", () => {
  if (currentIndex < entries.length - 1) currentIndex++;
  renderEntries();
});
document.getElementById("prevBtn").addEventListener("click", () => {
  if (currentIndex > 0) currentIndex--;
  renderEntries();
});

// Refresh data every 15 s (adjust if needed)
setInterval(loadScript, 15000);

// Initial load
loadScript();
</script>

</body>
</html>
